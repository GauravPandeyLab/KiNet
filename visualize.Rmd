```{r}
library(shiny)
library(visNetwork)
```
# Visualize pathways
##  {.sidebar data-width="200"}
##### Select a pathway category and pathway
```{r, cache = FALSE}
selectInput(inputId='pathwayCategory',label=NULL, choices=pathway_categories,selected=default_pathway_category)
selectInput(inputId='pathwayName',label=NULL,choices=pathway_choices[[default_pathway_category]] %>% pull(Term))
observeEvent(input$pathwayCategory,{
  updateSelectInput(inputId='pathwayName',choices = pathway_choices[[input$pathwayCategory]] %>% pull(Term))
})

checkboxInput(inputId='toggleOneDegree', "Show nodes one degree away.", value = FALSE)
checkboxInput(inputId='toggleRemoveDisconnected', "Remove disconnected nodes.", value = FALSE)
initialGeneList <- reactive({get_pathway_genes(input$pathwayCategory, input$pathwayName)})

#displayedProteins <- reactive({get_displayed_proteins(proteinList(), input$toggleOneDegree, input$toggleDisconnectedNodes)})
#infoProtein <- reactive({na.omit(c(input$selectProtein,displayedProteins()[[1]])[[1]])})
```

##### Change font-size
``` {r,cache=FALSE}
sliderInput("fontSize2",label=NULL,min = 10, max = 50, value = 30)
```
## Main Panel
### Kinase-substrate interactions in `r renderText(input$pathwayName)`
```{r,cache=FALSE}
g2 <- reactive({get_pathway_graph(initialGeneList(),input$toggleOneDegree,input$toggleRemoveDisconnected)})
visNetworkOutput('network2')
output$network2 <- renderVisNetwork({
  visNetwork(nodes=g2()$nodes,edges=g2()$edges,physics=F) %>%
  visIgraphLayout() %>% 
  visNodes(font=list(size=30)) %>% 
  visEdges(arrows="to") %>%
  visOptions(highlightNearest = list(enabled=TRUE,labelOnly=F))  %>%
  visEvents(select="function(nodes){Shiny.onInputChange('selectNode2',nodes.nodes);}") %>%
  visEvents(doubleClick="function(nodes){Shiny.onInputChange('nextCenterNode',nodes.nodes)}") 
   })

infoGene1 <- reactive({
  if(is.null(input$selectNode2)) {NULL} else {get_gene_name(input$selectNode2)}
  })
observe({visNetworkProxy("network2") %>% visNodes(font=list(size=input$fontSize2))})

```

##  {data-width="200"}
##### Click on a node to see its information 
```{r,cache=FALSE}
# observe({
#   if(!is.null(input$selectNode1)) {
#     renderUI({render_gene_info(get_gene_name(input$selectNode1))})
#   }
# })
renderUI({render_gene_info(infoGene1())})
```
